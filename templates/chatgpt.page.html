{{template "base" .}}

{{define "css"}}
<link rel="stylesheet" href="/static/css/chatgptpage.css">
{{end}}

{{define "title"}}
<title>
  Create a new account
</title>
{{end}}

{{define "content"}}
<section class="chat_gpt-section">
  <div class="chat-container">
    <h3 class="section-title">Chat with ChatGPT</h3>

    <div class="chat-response">
      <p id="prompt_response" class="chat_prompt_response">No prompt found! Please add a new one!</p>
    </div>

  </div>
  <form id="chat_form" class="chat-form" action="/chatgpt" method="post">
    <input type="hidden" name="csrf_token" id="csrf_token" value="{{ .CSRFToken}}"/>
    <textarea row="1" class="chat_textarea" id="chat_prompt" name="chat_prompt" required placeholder="Enter Text you want to ask" required></textarea>
    <button class="submit-btn" id="chat-submit" type="button"><img src="/static/images/send-arrow.svg" alt="Ask"></button>
  </form>
</section>
{{end}}
{{define "js"}}
<script>
  const gptForm = document.getElementById('chat_form');
  const submitBtn = document.getElementById('chat-submit');
  const csrfToken = document.getElementById('csrf_token');
  const chatPrompt = document.getElementById('chat_prompt');
  const promptResponse = document.getElementById('prompt_response')
  submitBtn.addEventListener('click', () => {
    fetch('/chatgpt', {
      method: "POST",
      body: JSON.stringify({
        chat_prompt: chatPrompt
      }),
      headers: {
        "Content-type": "application/json",
        "X-CSRF-Token": csrf_token.value,
      }
    })
    .then(response => response.json())
    .then(result => {
      if (result.error) {
        promptResponse.classList.add('invalid_prompt')
        promptResponse.innerText = result.message
      } else {
        promptResponse.classList.remove('invalid_prompt')
        promptResponse.innerText = result.message
      }
    });
  })
</script>
{{end}}